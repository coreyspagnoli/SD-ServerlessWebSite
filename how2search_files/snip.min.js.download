var SpaiSniper=function(e){var t=/([\/\+,]ret_(?:img|wait))[^\/]*\/https?:\/\//,s=[],i=0,a=false;if(e==0){jQuery(document).ready((function(){X();jQuery("#spai-snip-loader").detach().prependTo("body");jQuery("#spai-snip-response").detach().prependTo("body");jQuery("#spai-smps").detach().appendTo("li.shortpixel-ai-sniper")}))}else if(e==1){n()}function n(){R();I();jQuery("#spai-smp-message").css("display","none");m();z();o(1);ShortPixelAI.sniperOn=true}function r(e){if(e>=1073741824){e=(e/1073741824).toFixed(2)+" GB"}else if(e>=1048576){e=(e/1048576).toFixed(2)+" MB"}else if(e>=1024){e=(e/1024).toFixed(2)+" KB"}else if(e>1){e=e+" bytes"}else if(e==1){e=e+" byte"}else{e="0 bytes"}return e}function l(){R();I();jQuery("#spai-smp-message").css("display","none");f();z();o(0);if(a){window.removeEventListener("keydown",a);a=false}ShortPixelAI.sniperOn=false}function o(e){jQuery("div.spai-snip-info").remove();if(e){jQuery("img:visible").each((function(){var e=jQuery(this);if(e.is("#wpadminbar *"))return;var t=(this.src.indexOf(spai_settings.api_url.match(/.*\//)[0])>=0||this.src.indexOf("data:image/svg+xml")>=0)&&!ShortPixelAI.is(e,ShortPixelAI.EXCLUDED);var s=jQuery('<div class="spai-snip-info'+(t?" spai-snip-info-cdn":"")+'"><div>'+(t?"CDN":"ORIGIN")+"</div></div>");s.css("left",7+parseInt(e.css("margin-left"))+"px");s.css("bottom",29+parseInt(e.css("margin-bottom"))+"px");e.after(s)}));jQuery("div:visible,span:visible").each((function(){var e=jQuery(this);if(e.is("#wpadminbar *"))return;var t=e.css("background-image");if(!t.match(/url\s*\(/))return;var s=t.indexOf(spai_settings.api_url.match(/.*\//)[0])>=0||t.indexOf("data:image/svg+xml")>=0;var i=jQuery('<div class="spai-snip-info'+(s?" spai-snip-info-cdn":"")+'"><div class="spai-snip-info-bk">'+(s?"CDN":"ORIGIN")+"</div></div>");var a=7,n=29;if(e.css("float")!="none"){i.css("float",e.css("float"));a-=parseInt(e.css("width"));n-=parseInt(e.css("height"))}i.css("left",a+parseInt(e.css("margin-left"))+"px");i.css("bottom",n+parseInt(e.css("margin-bottom"))+"px");e.after(i)}))}}function p(e,t){var s=null;var i=e["img_url"];var a=i.split("/").splice(5).join("/");c(e,"optimized_size",i,t);c(e,"original_size",a,t)}function c(e,t,s,i){var a=function(){if(typeof e.original_size!=="undefined"&&typeof e.optimized_size!=="undefined"&&e.optimized_size<e.original_size){i.find("span.spai-bytes").html("<br>Size reduced from "+r(e.original_size)+" to "+r(e.optimized_size))}};var n=performance.getEntriesByName(s)[0];if(n!==undefined&&n.decodedBodySize>0){e[t]=n.decodedBodySize}else{var l=new XMLHttpRequest;l.open("GET",s,true);l.responseType="blob";l.onload=function(){blob=l.response;e[t]=blob.size;a()};l.send()}}function u(){var e=location.href.split("/");if(e[e.length-1].indexOf(".php")>=0||e[e.length-1].indexOf(".asp")>=0||e[e.length-1].indexOf(".html")>=0||e[e.length-1]==""){e.pop()}e=e.join("/");e=e.split("/#");e.pop();e=e.join("/#");return e}function d(e){var t=e.split("/");var s=t[t.length-1].split(".");if(s.length>=2){if(s[s.length-2].match(/-\d+x\d+$/im)!=null&&s[s.length-2].match(/-\d+x\d+$/im).length>0){var i=s[s.length-2].split("-");i.pop();s[s.length-2]=i.join("-")}}t[t.length-1]=s.join(".");return t.join("/")}function m(){jQuery("body").addClass("spai-cursor-crosshair")}function f(){jQuery("body").removeClass("spai-cursor-crosshair")}function g(e,t){if(document.elementsFromPoint!==undefined){var s=[];var i=document.elementsFromPoint(e,t);for(var a=0;a<i.length;a++){var n=h(i[a]);if(!!n&&n!==s[s.length-1]){s.push(n)}}return s}else{if(document.elementFromPoint==undefined)return false;var s=[];var r=1;try{while(r<=300){var n=h(document.elementFromPoint(e,t));if(!!n&&(s.length===0||n[0]!==s[s.length-1].obj[0])){s.push({obj:n,visibility:n.css("visibility")})}n.css("visibility","hidden");r++}for(var a=0;a<s.length;a++){s[a].obj.css("visibility",s[a].visibility);s[a]=s[a].obj}return s}catch(e){return false}}}function h(e){var t=jQuery(e);if(t.hasClass("shortpixel_ai_sniper"))throw"break";if(!e||e===document.documentElement||t.is(jQuery("body"))){return false}if(!t.hasClass("spai-smp-trigger")&&t.closest(".spai-smp-trigger").length===0){return t}return false}function _(e){var t=jQuery(e.target);if(t.hasClass("spai-smp-trigger")||t.closest(".spai-smp-trigger").length>0){return}var a=g(e.clientX,e.clientY);if(a===false){a=[];a.push(t)}for(var n=0;n<a.length;n++){if(jQuery(a[n]).closest("#spai-smps").length>0){var r=t.closest("a.spai-smp-multiple-list-item-container-link");if(r.length>0){i=parseInt(r.attr("data-img-id"));x(s[i])}return false}}R();a=j(a);if(a["all"].length>1){s=a["all"];b()}else if(a["all"].length===1){s=a["all"];i=0;x(a["all"][0])}else{s=[];l();var o=jQuery("#spai-smp-message");var p=o.find(".spai-smp-message-body");if(p.text().trim().length==0){p.html('Please click on the image that you want to inspect. <a href="https://help.shortpixel.com/article/338-how-to-use-the-image-checker-tool" target="_blank">More details</a>')}o.css("display","block")}}function v(e){var t=e.split("url(");if(t.length>1){t=t[1];if(t[0]=='"'){t=t.substr(1)}t=t.split(")");t=t[0];if(t[t.length-1]=='"'){t=t.substr(0,t.length-1)}return t.length?t:false}return false}function y(e){e=jQuery(e);var t=[];while(!e.is(jQuery("body"))){var s=e.prop("tagName").toLowerCase();if(e.attr("id")!=undefined&&e.attr("id")!=null&&e.attr("id").length>0){s+="#"+e.attr("id").replace(/ /,".")}if(e.attr("class")!=undefined&&e.attr("class")!=null&&e.attr("class").length>0){s+="."+e.attr("class").replace(/ /g,".")}t.push(s);e=e.parent()}t.reverse();return t.join(" > ")}function j(e){var s={all:[],URL_MATCH:[],EXCLUDED_PATH_MATCH:[],EXCLUDED_SELECTOR_MATCH:[],NORESIZE_SELECTOR_MATCH:[],EAGER_SELECTOR_MATCH:[],NO:[],total:0};var i=[["excluded_paths","EXCLUDED_PATH_MATCH"],["excluded_selectors","EXCLUDED_SELECTOR_MATCH"],["noresize_selectors","NORESIZE_SELECTOR_MATCH"],["eager_selectors","EAGER_SELECTOR_MATCH"]];for(var a=0;a<e.length;a++){var n=false;var r=u();if(e[a].prop("tagName").toLowerCase()==="img"){n=e[a].attr("src")}else if(e[a].css("background-image")!=undefined&&e[a].css("background-image")!=""&&e[a].css("background-image")!=null&&e[a].css("background-image")!="none"){n=v(e[a].css("background-image"));if(n===document.location.href){n=false}}if(n!==false){if(n.indexOf(r)===-1&&n.indexOf("http://")===-1&&n.indexOf("https://")===-1){n=r+"/"+n}var l=y(e[a]);var o=n.match(t);var p="";var c="";if(o!=null&&o.length>0){p="URL_MATCH"}else{for(var m=0;m<i.length&&p.length===0;m++){var f=i[m][0];var g=i[m][1];var h=spai_settings[f];for(var _=0;_<h.length&&p.length===0;_++){if(f==="excluded_paths"){if(h[_].indexOf("regex:")===0){var j=h[_].replace("regex://","").replace(/\\\//,"/").substr(1);j=j.substr(0,j.length-1);var b=new RegExp(j);var o=n.match(b);if(o!=null&&o.length>0){p=g;c=h[_]}}else{var Q=document.createElement("a");Q.href=d(n);var x=document.createElement("a");x.href=d(h[_]);if(Q.hostname===x.hostname&&Q.pathname===x.pathname){p=g;c=h[_]}}}else{try{var C=jQuery(h[_])}catch(e){C=[]}for(var E=0;E<C.length&&p.length===0;E++){if(e[a].is(jQuery(C[E]))){p=g;c=h[_]}}}}}}if(p.length===0){p="NO"}var k=e[a].prop("tagName").toLowerCase();var T={img_url:n,elem:e[a],selector:l,satisfies:p,excluded_selector:c,tag:k};s[p].push(T);s["all"].push(T)}}return s}function b(){var e="";I();for(var t=0;t<s.length;t++){var i=s[t]["img_url"].split("/");i=i[i.length-1];var a="<div>"+'<div class="spai-smp-multiple-list-item-container">'+'<a class="spai-smp-multiple-list-item-container-link" href="#" data-img-id="'+t+'">'+'<div class="spai-smp-single-item-container-image-container">'+'<img src="'+s[t]["img_url"]+'" class="spai-smp-multiple-list-item-container-image" alt=""/>'+"<br><span>"+i+"</span>"+"</div>"+"</a>"+"</div>";e+=a}var a=jQuery("<div />").append(jQuery("<button />").addClass("spai-smp-options-button-cancel").text("Cancel"));e+=a.html();jQuery("#spai-smp-multiple-list").empty();jQuery("#spai-smp-multiple-list").html(e);jQuery("#spai-smp-multiple").show()}function Q(){return jQuery("#spai-smp-multiple").is(":visible")}function x(e){R();I();var t=e["img_url"].split("/");t=t[t.length-1];var i=jQuery("#spai-smp-single-template").clone();if(e["satisfies"]==="NO"){i.attr("id","spai-smp-single");i.addClass("spai-smp-main");i.find(".spai-smp-single-item-container-image").attr("src",e["img_url"]);i.find(".spai-smp-single-item-container-basename").text(t);i.find(".spai-smp-single-title").text("Image not optimized.");i.find(".spai-smp-single-details").text("");i.find(".spai-smp-single-options").append(jQuery("<div />").attr("class","spai-smp-option").append(jQuery('<a target="_blank" href="https://help.shortpixel.com/article/220-i-installed-shortpixel-adaptive-images-but-it-doesnt-seem-to-work"/>').text("Why isn't this image included?")));if(s.length>1){i.find(".spai-smp-buttons").append(jQuery("<button />").addClass("spai-smp-options-button-back").text("Back"))}i.find(".spai-smp-buttons").append(jQuery("<button />").addClass("spai-smp-options-button-cancel").text("Cancel"));jQuery("#spai-smps").append(i);jQuery("#spai-smp-single").show()}else if(jQuery.inArray(e["satisfies"],["EXCLUDED_PATH_MATCH","EXCLUDED_SELECTOR_MATCH","NORESIZE_SELECTOR_MATCH","EAGER_SELECTOR_MATCH"])>=0){var n={EXCLUDED_PATH_MATCH:"excluded_paths",EXCLUDED_SELECTOR_MATCH:"excluded_selectors",NORESIZE_SELECTOR_MATCH:"noresize_selectors",EAGER_SELECTOR_MATCH:"eager_selectors"};i.attr("id","spai-smp-single");i.addClass("spai-smp-main");i.find(".spai-smp-single-item-container-image").attr("src",e["img_url"]);i.find(".spai-smp-single-item-container-basename").text(t);i.find(".spai-smp-single-title").html("Image is excluded. <span>"+(e["satisfies"]=="EXCLUDED_PATH_MATCH"?"Path":"Selector")+": <i>"+e["excluded_selector"]+"</i></span>");i.find(".spai-smp-single-details").text("");i.find(".spai-smp-single-options").append(jQuery("<div />").attr("class","spai-smp-option").append(jQuery("<a />").attr("href","#").attr("data-action","remove_selector_from_list").attr("data-list",n[e["satisfies"]]).text("Remove the excluding rule")));if(s.length>1){i.find(".spai-smp-buttons").append(jQuery("<button />").addClass("spai-smp-options-button-back").text("Back"))}i.find(".spai-smp-buttons").append(jQuery("<button />").addClass("spai-smp-options-button-cancel").text("Cancel"));i.find("a").click((function(t){t.preventDefault();var s="";var a="";var n='"'+jQuery(this).text()+'"'+e["excluded_selector"]+'" has been selected';if(jQuery(this).attr("data-action")!=undefined&&jQuery(this).attr("data-list")!=undefined){s="shortpixel_ai_"+jQuery(this).attr("data-action");a=jQuery(this).attr("data-list")}if(s!=""){C(i,s,e["excluded_selector"],a)}else{alert(n);l()}return false}));jQuery("#spai-smps").append(i);jQuery("#spai-smp-single").show()}else if(e["satisfies"]==="URL_MATCH"){i.attr("id","spai-smp-single");i.addClass("spai-smp-main");i.find(".spai-smp-single-item-container-image").attr("src",e["img_url"]);i.find(".spai-smp-single-item-container-basename").text(t);var r=e["img_url"].split("/");var o=0;if(r.length>4){var c=r[4].match(/w_([0-9]+)/);if(!!c&&c.length>1){o=c[1]}}var u=i.find(".spai-smp-single-title");u.html('Image optimized <span class="spai-pixels"></span><span class="spai-bytes"></span>');if(o){var d=new Image;d.onload=function(){if(d.naturalWidth>o)u.find("span.spai-pixels").text(" and scaled from "+d.naturalWidth+"px to "+o+"px.")};d.src=r.splice(5).join("/")}p(e,u);i.find(".spai-smp-single-details").text("");i.find(".spai-smp-single-options").append(jQuery("<div />").attr("class","spai-smp-option").append(jQuery("<a />").attr("href","#").text("Exclude images like this one from optimization.").attr("data-action","exclude_images_like_this_from_optimization")));i.find(".spai-smp-single-options").append(jQuery("<div />").attr("class","spai-smp-option").append(jQuery("<a />").attr("href","#").text("Exclude this image URL.").attr("data-action","exclude_this_image_only")));var m="";var f="";if(spai_settings["noresize_selectors"].length>0){for(var g=0;g<spai_settings["noresize_selectors"].length;g++){try{var h=jQuery(spai_settings["noresize_selectors"][g])}catch(e){var h=[]}for(var _=0;_<h.length;_++){if(e["elem"].is(jQuery(h[_]))){i.find(".spai-smp-single-options").append(jQuery("<div />").attr("class","spai-smp-option").append(jQuery("<a />").attr("href","#").attr("data-action","remove_selector_from_list").attr("data-list","noresize_selectors").text("Remove the no resize rule.")));m=spai_settings["noresize_selectors"][g];_=h.length;g=spai_settings["noresize_selectors"].length}}}}if(m===""){i.find(".spai-smp-single-options").append(jQuery("<div />").attr("class","spai-smp-option").append(jQuery("<a />").attr("href","#").text("Do not resize images like this one.").attr("data-action","do_not_resize_images_like_this")))}if(spai_settings["eager_selectors"].length>0){for(var g=0;g<spai_settings["eager_selectors"].length;g++){try{var v=jQuery(spai_settings["eager_selectors"][g])}catch(e){var v=[]}for(var _=0;_<v.length;_++){if(e["elem"].is(jQuery(v[_]))){i.find(".spai-smp-single-options").append(jQuery("<div />").attr("class","spai-smp-option").append(jQuery("<a />").attr("href","#").attr("data-action","remove_selector_from_list").attr("data-list","eager_selectors").text("Remove the lazy-load rule.")));f=spai_settings["eager_selectors"][g];_=v.length;g=spai_settings["eager_selectors"].length}}}}if(f===""){i.find(".spai-smp-single-options").append(jQuery("<div />").attr("class","spai-smp-option").append(jQuery("<a />").attr("href","#").text("Do not lazy-load images like this one.").attr("data-action","do_not_lazy_load_images_like_this")))}i.find(".spai-smp-single-options").append(jQuery("<div />").attr("class","spai-smp-option").append(jQuery("<a />").attr("href","#").text("Refresh on CDN.").attr("data-action","refresh_on_cdn")));if(s.length>1){i.find(".spai-smp-buttons").append(jQuery("<button />").addClass("spai-smp-options-button-back").text("Back"))}i.find(".spai-smp-buttons").append(jQuery("<button />").addClass("spai-smp-options-button-cancel").text("Cancel"));i.find("a").click((function(t){t.preventDefault();if(jQuery(this).attr("data-action")==="refresh_on_cdn"){M({elem:e,trial_count:0})}else if(jQuery(this).attr("data-action")==="exclude_this_image_only"){var s=e["img_url"].split(/ret_(?:img|wait)[^\/]*\/(https?:\/\/.*)/);if(!confirm("Are you sure you want to exclude this image URL from optimization?\n"+s[s.length>1?1:0]))return;var n="excluded_paths";C(i,"shortpixel_ai_add_selector_to_list",e["img_url"],n)}else if(jQuery(this).attr("data-action")==="do_not_resize_images_like_this"||jQuery(this).attr("data-action")==="exclude_images_like_this_from_optimization"||jQuery(this).attr("data-action")==="do_not_lazy_load_images_like_this"){l();z();var r=E(e["elem"]);var o=w(r,e["selector"]);var p=A(o.selector);var c=jQuery("#spai-smp-single-template").clone();c.attr("data-action",jQuery(this).attr("data-action"));c.find(".spai-smp-single-item-container").remove();var u=k(jQuery(this).attr("data-action"));c.find(".spai-smp-single-title").text("Really want to stop "+u.verb+" these images?");c.find(".spai-smp-single-details").html("Use the controls below to create the CSS selector needed. Try to keep it as simple as possible. "+'<a href="https://help.shortpixel.com/article/338-how-to-use-the-image-checker-tool" target="_blank">How do I use this?</a>');c.find(".spai-smp-single-options").append(jQuery("<div />").append(jQuery("<input />").addClass("spai-smp-single-options-input-selector").attr("type","text")).append(jQuery("<button />").addClass("spai-smp-single-options-button-show").text("Show")));var d=jQuery('<p data-setting="'+u.setting+'"/>').addClass("spai-smp-single-options-hint");c.find(".spai-smp-single-options").append(d);T(d,p);c.find(".spai-smp-buttons").append(jQuery("<button />").addClass("spai-smp-options-button-back2").text("Back"));c.find(".spai-smp-buttons").append(jQuery("<button />").addClass("spai-smp-single-options-button-confirm").text("Yes")).append(jQuery("<button />").addClass("spai-smp-options-button-cancel").text("Cancel"));var g=jQuery(this);c.find(".spai-smp-single-options-button-show").click((function(e){var t=c.find(".spai-smp-single-options-input-selector").val();try{z();T(c.find("p.spai-smp-single-options-hint"),A(t))}catch(e){alert(e.message)}}));c.find(".spai-smp-single-options-button-confirm").click((function(e){e.preventDefault();var t=c.find(".spai-smp-single-options-input-selector").val();var s=c.attr("data-action");if(s==="do_not_resize_images_like_this"||s==="exclude_images_like_this_from_optimization"||s==="do_not_lazy_load_images_like_this"){try{jQuery(t)}catch(e){alert(e.message);return}var i="";if(s==="do_not_resize_images_like_this"){var i="noresize_selectors"}else if(s==="exclude_images_like_this_from_optimization"){var i="excluded_selectors"}else if(s==="do_not_lazy_load_images_like_this"){var i="eager_selectors"}C(c,"shortpixel_ai_add_selector_to_list",t,i)}else{alert("Confirm has been clicked for selector "+t+". Data action was "+s);l()}return false}));jQuery("#spai-smp-single").remove();c.attr("id","spai-smp-single");jQuery("#spai-smps").append(c);jQuery("#spai-smp-single").show();var h=c.find(".spai-smp-single-options-input-selector");L(o.liniar,h);var _=c.find(".spai-selector-elements")[0];_.scrollLeft=_.scrollWidth;h.val(o.selector);window.addEventListener("keydown",a=function(e){if(e.keyCode==37){_.scrollLeft-=Math.min(_.scrollLeft,100)}else if(e.keyCode==39){_.scrollLeft+=Math.min(100,_.scrollWidth-_.scrollLeft)}})}else if(jQuery(this).attr("data-action")==="remove_selector_from_list"){var n=jQuery(this).attr("data-list");var v="";if(n=="eager_selectors"){v=f}else if(n=="noresize_selectors"){v=m}console.log(n);console.log(v);C(i,"shortpixel_ai_remove_selector_from_list",v,n)}return false}));jQuery("#spai-smps").append(i);jQuery("#spai-smp-single").show()}}function C(e,t,s,i){jQuery("#spai-snip-loader").show();e.hide();jQuery.ajax({url:spai_settings.ajax_url,data:{action:t,selector:s,which_list:i},method:"POST",complete:function(e,s){jQuery("#spai-snip-loader").hide();var a="An error occurred, please contact support.";if(s==="success"&&e.responseText!=undefined&&e.responseText.length>0){try{var n=JSON.parse(e.responseText);if(n["status"]!=undefined&&n["status"]!=null&&n["message"]!=undefined&&n["message"]!=null){if(n["status"]==="ok"){if(n["list"]!=undefined&&n["list"]!=null){spai_settings[i]=n["list"]}if(t==="exclude_images_like_this_from_optimization"){var r=P(elem["img_url"]);if(elem["tag"]==="img"){elem["elem"].attr("src",r)}else{elem["elem"].css("background-image","url('"+r+"')")}}}}a=n["message"]}catch(e){}}var o=jQuery("#spai-snip-response");jQuery(".spai-snip-loader-text span").text(a);l();o.show()}})}function E(e){e=jQuery(e);var t=0,s=[];while(!e.is(jQuery("body"))){var i={tag:{value:e.prop("tagName").toLowerCase(),type:"tag",selected:false},id:{value:e.attr("id"),type:"id",selected:false},classes:[]};var a=e.attr("class");a=a!=undefined&&a!=""&&a!=null?a.split(" "):[];for(var n=a.length-1;n>=0;n--){if(a[n].length){i.classes.push({value:a[n],type:"class",selected:false})}}s.push(i);e=e.parent()}return s}function k(e){var t={};if(e==="do_not_resize_images_like_this"){t.verb="resizing";t.setting="Don't resize"}else if(e==="exclude_images_like_this_from_optimization"){t.verb="optimizing";t.setting="Excluded"}else if(e==="do_not_lazy_load_images_like_this"){t.verb="lazy-loading";t.setting="Don't lazy-load"}return t}function T(e,t){var s=spai_settings.excluded_selectors.length+spai_settings.noresize_selectors.length+spai_settings.eager_selectors.length;e.html((t>1?"Scroll to see all <b>"+t+"</b> images":"<b>One image</b>")+" "+" matched by this selector on this page. The rule will be added to the <b>"+e.attr("data-setting")+' selectors</b> list in <a href="/wp-admin/options-general.php?page=shortpixel-ai-settings#top#exclusions" target="_blank">'+"ShortPixel AI Settings"+"</a> and applied to <b>all the pages of your website</b>."+(s>5?'<br><span style="color:#f45656;">You already have '+s+" selectors active. Please keep the number of exclusion selectors low for site performance.</span>":""))}function w(e,t){var s={selector:"",precision:Number.MAX_SAFE_INTEGER,data:[],liniar:[],add:function(e,t,s){if(e){this.precision=s;this.selector=e+this.selector}this.data.push(t);var i=[];i.push(t.tag);if(t.id.value){i.push(t.id)}for(var a=0;a<t.classes.length;a++){i.push(t.classes[a])}this.liniar=i.concat(this.liniar)}};for(var i=0,a=e.length-1;i<=a;i++){if(s.precision===1&&s.data.length>=4)break;var n=e[i];if(s.precision==1){s.add(false,n,false);continue}var r=n.tag.value;n.tag.selected=true;var l=s.precision;var o=" "+r;var p=jQuery(o+s.selector).length;if(p==1){s.add(o,n,1)}l=Math.min(p,s.precision);var c=n.id.value;if(c!=undefined&&c!=""&&c!=null){p=jQuery(o+"#"+c+s.selector).length;if(l>1&&p<l){o=o+"#"+c;n.id.selected=true;l=p;if(p===1){s.add(o,n,1)}}}var u=n.classes;for(var d=0;d<u.length;d++){var m=u[d];p=jQuery(o+"."+m.value+s.selector).length;if(l>1&&p<l){o=o+"."+m.value;m.selected=true;l=p;if(p===1){s.add(o,n,1)}}}if(l>1&&l<s.precision){s.add(o,n,l)}}if(s.selector.length===0){s.selector=t}return s}function z(){jQuery(".spai-sm-image-overlay").removeClass("spai-sm-image-overlay")}function A(e){var t=jQuery(e);for(var s=0,i=0;s<t.length;s++){if(jQuery(t[s]).closest("#wpadminbar").length===0){var a=jQuery(t[s]);a.addClass("spai-sm-image-overlay");if(a.is(":visible")){i++}}}return i}function L(e,t){var s='<div class="spai-selector-elements"><span class="spai-selector-button spai-selector-getparent">&lt;&lt;</span>';for(var i=0;i<e.length;i++){s=s+'<span data-index="'+i+'"'+' class="spai-selector-element spai-selector-element-'+e[i].type+" spai-selector-element-"+(e[i].selected?"on":"off")+'">'+e[i].value+"</span>"}t.before(s+"</div>");jQuery("span.spai-selector-element").on("click",(function(){O(this)}));jQuery("span.spai-selector-getparent").on("click",(function(){S(this)}))}function O(e){var t=e.classList.contains("spai-selector-element-on")?"on":"off";e.classList.remove("spai-selector-element-"+t);e.classList.add("spai-selector-element-"+(t==="on"?"off":"on"));var s=D();document.getElementsByClassName("spai-smp-single-options-input-selector")[0].value=s.selected.trim();z();T(jQuery(e.parentElement.parentElement.parentElement).find(".spai-smp-single-options-hint"),A(s.selected))}function S(e){var t=D();var s=document.querySelector(t.all);for(var i=t.elementsCount;i>0;i--){s=s.parentElement}var a='<span class="spai-selector-element spai-selector-element-off spai-selector-element-tag">'+s.tagName.toLowerCase()+"</span>"+(s.getAttribute("id")===null?"":'<span class="spai-selector-element spai-selector-element-off spai-selector-element-id">'+s.getAttribute("id")+"</span>");for(var n=0;n<s.classList.length;n++){a+='<span class="spai-selector-element spai-selector-element-off spai-selector-element-class">'+s.classList[n]+"</span>"}var r=document.createElement("div");r.innerHTML=a;for(n=r.childNodes.length-1;n>=0;n--){e.insertAdjacentElement("afterend",r.childNodes[n])}jQuery("span.spai-selector-element").off("click");jQuery("span.spai-selector-element").on("click",(function(){O(this)}))}function D(){var e=document.querySelectorAll("#spai-smps div.spai-selector-elements .spai-selector-element");for(var t="",s="",i=0,a=0;a<e.length;a++){var n=e[a];i+=n.classList.contains("spai-selector-element-tag")?1:0;var r=(n.classList.contains("spai-selector-element-tag")?" ":n.classList.contains("spai-selector-element-id")?"#":".")+n.innerText;s+=r;if(n.classList.contains("spai-selector-element-off"))continue;t+=r}return{selected:t,all:s,elementsCount:i}}function R(){jQuery("#spai-smp-multiple").hide();jQuery("#spai-smp-multiple-list").empty();z()}function I(){jQuery("#spai-smp-single").remove();z()}function M(e){if(e["elem"]==undefined){alert("Invalid parameters have been passed to the function. Please try again.");l();return}if(e["trial_count"]==undefined||!jQuery.isNumeric(e["trial_count"])){e["trial_count"]=0}if(e["trial_count"]>=3){if(e["error"]!=undefined&&jQuery.trim(e["error"]).length>0){alert(e["error"])}else{alert("An error occurred, please contact support.")}jQuery("#spai-snip-loader").hide();l();return}var t=N(e["elem"]["img_url"],"+f_remove");jQuery(".spai-snip-loader-text").text("Refreshing...");jQuery("#spai-snip-loader").show();jQuery.ajax({url:t,method:"GET",complete:function(t,s){e["trial_count"]++;if(s==="success"){if(t.responseText!=undefined&&t.responseText.length>0){if(t.responseText.indexOf('Message":"Success.')>0){e["error"]="";jQuery(".spai-snip-loader-text").text("Checking...");setTimeout((function(){H(e)}),5e3)}else{e["error"]="An error occurred, please contact support.";M(e)}}else{e["error"]="An error occurred, please contact support.";M(e)}}else{e["error"]="An error occurred, please contact support.";M(e)}}})}function H(e,t){if(e["elem"]==undefined){alert("Invalid parameters have been passed to the function. Please try again.");l();return}var s=U(e["elem"]["img_url"]);jQuery.ajax({url:s,method:"GET",complete:function(s,i){if(i==="success"){if(s.status>=300&&s.status<=399){jQuery("#spai-snip-loader").show();setTimeout((function(){H(e,t+1)}),1e4)}else if(s.status==200){if(e["elem"]["tag"]==="img"){e["elem"]["elem"].attr("src",U(e["elem"]["img_url"]))}else{e["elem"]["elem"].css("background-image","url('"+U(e["elem"]["img_url"])+"')")}jQuery("#spai-snip-loader").hide();var a=jQuery("#spai-snip-response");jQuery(".spai-snip-loader-text").text("Image CDN cache was cleared and image was refreshed. If you do not see the expected change, please clear the browser cache and then refresh the page.");l();a.show();setTimeout((function(){a.hide()}),5e3)}else{e["error"]="An error occurred, please contact support.";H(e)}}else if(s.state()=="rejected"){setTimeout((function(){H(e,t+1)}),1e4)}else{e["error"]="An error occurred, please contact support.";H(e)}}})}function N(e,t){if(e.indexOf(t)>=0||e.split("/spai/").length<2||e.indexOf("/http")===-1){return e}else{var s=e.split("/spai/")[0]+"/spai/";var i=e.split("/spai/")[1].split("/http");var i=i[0]+t+"/http"+i[1];e=s+i;return e}}function P(e){if(e.split("/spai/").length<2||e.indexOf("/http")===-1){return e}else{return"http"+e.split("/spai/")[1].split("/http")[1]}}function U(e){return e.split("#")[0]+"#t="+Date.now()}function X(){jQuery("body").on("click",(function(e){if(ShortPixelAI.sniperOn&&!jQuery("#spai-snip-loader").is(":visible")){_(e)}}));jQuery("body").on("click","a",(function(e){var t=jQuery(this);if(ShortPixelAI.sniperOn&&!t.hasClass("imagesHoverMenu-trigger")&&t.closest(".imagesHoverMenu-trigger").length===0&&(t.closest("#spai-smps").length===0||t.hasClass("spai-smp-multiple-list-item-container-link"))&&!jQuery("#spai-snip-loader").is(":visible")){e.preventDefault();_(e);return false}}));jQuery("body").on("click",".spai-smp-options-button-cancel",(function(e){e.preventDefault();l();return false}));jQuery("body").on("click",".spai-smp-options-button-retry",(function(e){e.preventDefault();l();n();return false}));jQuery("body").on("click",".spai-smp-options-button-back",(function(e){e.preventDefault();I();b();return false}));jQuery("body").on("click",".spai-smp-options-button-back2",(function(e){e.preventDefault();I();x(s[i]);return false}));jQuery("body").on("click","#spai-smps",(function(e){e.stopPropagation();e.stopImmediatePropagation()}))}};SpaiSniper(0);